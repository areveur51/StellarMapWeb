@startuml 04_frontend_api

skinparam backgroundColor #261D45
skinparam defaultFontColor #96DDF2

skinparam component {
  BackgroundColor #100D23
  BorderColor #0BE784
  FontColor #96DDF2
  ArrowColor #01C176
}

skinparam database {
  BackgroundColor #100D23
  BorderColor #0BE784
  FontColor #96DDF2
}

skinparam package {
  BackgroundColor #231B3D
  BorderColor #3f2c70
  FontColor #96DDF2
}

skinparam actor {
  BackgroundColor #0BE784
  BorderColor #0BE784
  FontColor #100D23
}

skinparam note {
  BackgroundColor #231B3D
  BorderColor #3f2c70
  FontColor #96DDF2
}

title <color:#0BE784>Frontend & API Architecture

top to bottom direction

actor User #0BE784

package "Frontend" #231B3D {
  component "Vue.js\nReactive UI" as Vue
  component "D3.js\nRadial/Tidy Tree" as D3
  component "Query Builder" as QueryBuilder
}

package "Core APIs" #231B3D {
  component "/api/pending-accounts/\n(30s cache)" as PendingAPI
  component "/search/\n(Main lineage search)" as SearchAPI
  component "/api/account-lineage/\n(No full scan)" as LineageAPI
}

package "Feature APIs" #231B3D {
  component "/web/high-value-accounts/\n(Multi-threshold)" as HVAAPI
  component "/web/query-builder/\n(10 pre-defined)" as QueryBuilderAPI
}

database "Astra DB\n(Cassandra)" as DB

User -[#01C176]-> Vue
User -[#01C176]-> D3
User -[#01C176]-> QueryBuilder

Vue -[#01C176]-> PendingAPI : "Polls 30s"
User -[#01C176]-> SearchAPI
D3 -[#01C176]-> LineageAPI
User -[#01C176]-> HVAAPI
QueryBuilder -[#01C176]-> QueryBuilderAPI

PendingAPI -[#01C176]-> DB
SearchAPI -[#01C176]-> DB
LineageAPI -[#01C176]-> DB
HVAAPI -[#01C176]-> DB
QueryBuilderAPI -[#01C176]-> DB

note right of PendingAPI #231B3D
  <color:#0BE784>Optimized Query:
  
  <color:#96DDF2>FROM search_cache
  WHERE status IN (
    'PENDING',
    'IN_PROGRESS',
    'RE_INQUIRY'
  )
  
  <color:#01C176>30s TTL cache
  <color:#01C176>88% fewer queries
end note

note right of SearchAPI #231B3D
  <color:#0BE784>Pipeline Initiation:
  <color:#96DDF2>1. Validate address
  <color:#96DDF2>2. Queue as PENDING
  <color:#0BE784>3. BigQuery processes
  <color:#96DDF2>4. Returns in 50-90s
  
  <color:#96DDF2>Up to 100K children
  <color:#0BE784>Comma-formatted
end note

note right of HVAAPI #231B3D
  <color:#0BE784>Multi-Threshold:
  <color:#96DDF2>• 10K-1M XLM selector
  <color:#96DDF2>• Smart query strategy
  <color:#96DDF2>• Partition-key lookups
  <color:#96DDF2>• Clickable links
  <color:#0BE784>• 24h rank changes
end note

note right of QueryBuilderAPI #231B3D
  <color:#0BE784>10 Pre-Defined Queries:
  <color:#96DDF2>• Stuck Accounts
  <color:#96DDF2>• Orphan Accounts
  <color:#96DDF2>• Failed Stages
  <color:#96DDF2>• HVA Accounts
  
  <color:#0BE784>Custom Builder:
  <color:#96DDF2>• Multi-column AND logic
  <color:#96DDF2>• Adaptive max_scan
  <color:#96DDF2>• Result limits: 50-500
end note

@enduml
