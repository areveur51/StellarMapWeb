@startuml Database Schema

skinparam backgroundColor #261D45
skinparam defaultFontColor #96DDF2

skinparam class {
  BackgroundColor #100D23
  BorderColor #0BE784
  FontColor #96DDF2
  ArrowColor #01C176
}

skinparam note {
  BackgroundColor #231B3D
  BorderColor #3f2c70
  FontColor #96DDF2
}

title Astra DB (Cassandra) Schema

class StellarAccountSearchCache {
  **+ stellar_account (PK)**
  **+ network_name (PK)**
  + status
  + cached_json
  + last_fetched_at
  + retry_count
  + created_at
  + updated_at
  --
  //12-hour cache//
}

class StellarCreatorAccountLineage {
  **+ id (PK)**
  **+ stellar_account (CK)**
  **+ network_name (CK)**
  **+ created_at (CK)**
  + stellar_creator_account
  + stellar_account_created_at
  + home_domain
  + xlm_balance
  + status
  + retry_count
  --
  //Lineage data//
}

class StellarAccountStageExecution {
  **+ stellar_account (PK)**
  **+ network_name (PK)**
  **+ created_at (PK)**
  **+ stage_number (CK)**
  + cron_name
  + status
  + execution_time_ms
  + error_message
  + updated_at
  --
  //Pipeline tracking//
}

class ManagementCronHealth {
  **+ id (PK)**
  **+ created_at (PK)**
  **+ cron_name (CK)**
  + status
  + execution_time_ms
  + error_message
  + updated_at
  --
  //Health monitoring//
}

note right of StellarAccountSearchCache #231B3D
  **Optimized Queries:**
  filter(status__in=[
    'PENDING',
    'IN_PROGRESS',
    'RE_INQUIRY'
  ])
end note

note right of ManagementCronHealth #231B3D
  **Health Statuses:**
  • HEALTHY
  • UNHEALTHY_RATE_LIMITED
  
  Cron skips when unhealthy
end note

@enduml
