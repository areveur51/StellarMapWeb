@startuml Data Pipeline

skinparam backgroundColor #261D45
skinparam activity {
    BackgroundColor #100D23
    BorderColor #0BE784
    FontColor #96DDF2
}
skinparam activityArrowColor #01C176
skinparam activityStartColor #0BE784
skinparam activityStopColor #E5526F
skinparam defaultFontColor #96DDF2
skinparam note {
  BackgroundColor #231B3D
  BorderColor #3f2c70
  FontColor #96DDF2
}

title <color:#0BE784>Data Collection: BigQuery (Primary) & API (Educational)

|<b><color:#0BE784>BigQuery Pipeline (50-90 seconds)|<b><color:#96DDF2>API Pipeline (2-3 minutes) - Educational|

start
start

:User Searches Address;
:User Searches Address;

:Query 1: Account Data;
:Stage 1: Make Parent Lineage;

note right #231B3D
  <color:#96DDF2>From <color:#0BE784>accounts_current
  <color:#96DDF2>Balance, flags, thresholds
end note

:Query 2: Asset Holdings;
:Stage 2: Collect Horizon Data;

note right #231B3D
  <color:#96DDF2>From <color:#0BE784>trust_lines_current
  <color:#96DDF2>Trustline data
end note

:Query 3: Creator Discovery;
:Stage 3: Account Attributes;

note right #231B3D
  <color:#96DDF2>From <color:#0BE784>enriched_history_operations
  <color:#96DDF2>Find parent (type=0)
end note

:Query 4: Child Accounts;
:Stage 4: Account Assets;

note right #231B3D
  <color:#96DDF2>Paginated (10K batches)
  <color:#96DDF2>Up to 100K children
  <color:#96DDF2>Handles airdrops
end note

:Update Database;
:Stage 5: Account Flags;

stop
:Stage 6: SE Directory;

note left #231B3D
  <color:#0BE784>BigQuery Features:
  <color:#96DDF2>• 2-3x faster than API
  <color:#96DDF2>• No rate limits
  <color:#96DDF2>• Complete history
  <color:#96DDF2>• ~$0.10-0.50/1K accounts
end note

note right #231B3D
  <color:#96DDF2>Stellar Expert enrichment
end note

:Stage 7: Account Creator;

:Stage 8: Make Grandparent;

stop

note left #231B3D
  <color:#96DDF2>API Pipeline (Reference):
  <color:#96DDF2>• 8 sequential stages
  <color:#96DDF2>• Horizon + Expert APIs
  <color:#96DDF2>• Educational purposes
  <color:#96DDF2>• Not enabled by default
end note

@enduml
