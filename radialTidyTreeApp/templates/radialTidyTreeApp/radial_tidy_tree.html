<!-- radialTidyTreeApp/templates/radialTidyTreeApp/radial_tidy_tree.html -->
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stellar Radial Tidy Tree</title>
    <!-- Secure CDN for D3.js (HTTPS) -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- Local JS via static tag for security -->
    <script src="{% static 'radialTidyTreeApp/d3-3.2.2/tidytree.js' %}"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #1a1a2e;
        }
        
        .page-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
        }
        
        h1 {
            padding: 15px 20px;
            color: white;
            background-color: #0f0f1e;
            font-size: clamp(16px, 3vw, 24px);
            text-align: center;
            flex-shrink: 0;
        }
        
        .visualization-container {
            flex: 1;
            width: 100%;
            min-height: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        #tree {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        /* SVG node glow effects */
        #tree circle {
            filter: drop-shadow(0 0 3px rgba(150, 221, 242, 0.4));
            transition: all 0.3s ease;
        }
        
        #tree circle:hover {
            filter: drop-shadow(0 0 8px rgba(150, 221, 242, 0.8)) drop-shadow(0 0 15px rgba(11, 231, 132, 0.4));
            transform: scale(1.2);
        }
        
        /* SVG link glow effects */
        #tree path {
            transition: all 0.3s ease;
        }
        
        #tree path:hover {
            stroke: #96DDF2 !important;
            stroke-width: 2.5 !important;
            filter: drop-shadow(0 0 5px rgba(150, 221, 242, 0.6));
        }
        
        /* SVG text glow effects */
        #tree text {
            filter: drop-shadow(0 0 2px rgba(150, 221, 242, 0.3));
            transition: all 0.3s ease;
        }
        
        #tree text:hover {
            filter: drop-shadow(0 0 6px rgba(150, 221, 242, 0.6));
            fill: #96DDF2 !important;
        }
        
        #details {
            display: none;
        }
    </style>
</head>
<body>
    <div class="page-container">
        <h1>Stellar Lineage Tree for {{ account }} ({{ network }})</h1>
        
        <!-- Include shared visualization toggle component -->
        {% include "radialTidyTreeApp/visualization_toggle_include.html" %}
        
        <div class="visualization-container">
            <svg id="tree"></svg>
        </div>
        <div id="details">{{ radial_tidy_tree_variable }}</div>  <!-- Placeholder for hover/details -->
    </div>

    <script>
        // Securely parse tree data from context (escaped by Django) and assign to global currentTreeData
        currentTreeData = {{ tree_data | safe }};
        
        // Initialize visualization with radial tree
        renderRadialTree(currentTreeData);
    </script>
</body>
</html>